<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Registration</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/stylesheets/createUser.css" />
  <link rel="icon" type="image/png" href="/favicon.png">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
  <div class="register-container">
    <h1 class="mb-4">User Registration</h1>

    <div id="password-alert" class="alert alert-danger hidden" role="alert">
      Passwords do not match. Please check again.
    </div>
    <div id="field-alert" class="alert alert-warning hidden" role="alert">
      All required fields must be filled out.
    </div>
    <div id="invalid-format-alert" class="alert alert-warning hidden" role="alert">
      Phone number or NIF is not in the correct format. Please enter valid
      values.
    </div>
    <div id="submit-success-alert" class="alert alert-success hidden" role="alert">
      Registration successful!
    </div>
    <div id="submit-error-alert" class="alert alert-danger hidden" role="alert">
      An error occurred during registration. Please try again.
    </div>

    <form class="form" method="post" action="/auth/registerSubmitted" enctype="multipart/form-data">
      <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <input type="text" id="name" name="name" class="form-control" placeholder="Enter your name" required />
      </div>
      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" id="email" name="email" class="form-control" placeholder="Enter your email" required />
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <input type="password" id="password" name="password" class="form-control" placeholder="Enter your password"
          required />
      </div>
      <div class="mb-3">
        <label for="confirmPassword" class="form-label">Confirm Password</label>
        <input type="password" id="confirmPassword" name="confirmPassword" class="form-control"
          placeholder="Confirm your password" required />
      </div>
      <div class="mb-3">
        <label for="profilePic" class="form-label">Profile Picture</label>
        <input type="file" id="profilePic" name="profilePic" class="form-control" accept="image/*" />
      </div>     
      <div class="mb-3">
        <label for="role" class="form-label">Role</label>
        <select class="form-select" id="role" name="role" required onchange="toggleForm()">
          <option value="" selected disabled>Select a role</option>
          <option value="Client">Client</option>
          <option value="Manager">Manager</option>
        </select>
      </div>
      
      <div id="cliente-fields" class="hidden">
        <div class="mb-3">
          <label for="clienteTelemovel" class="form-label">Phone Number</label>
          <input type="text" id="clienteTelemovel" name="clienteTelemovel" class="form-control"
            placeholder="Phone number" pattern="[0-9]{9}" title="The number must be 9 digits" />
        </div>
        <div class="mb-3">
          <label for="clienteNif" class="form-label">NIF</label>
          <input type="text" id="clienteNif" name="clienteNif" class="form-control" placeholder="Taxpayer Number"
            pattern="[0-9]{9}" title="NIF must be 9 digits" />
        </div>
        <div class="mb-3">
          <label for="address" class="form-label">Address</label>
          <input type="text" id="address" name="address" class="form-control" placeholder="Enter your address" />
        </div>
      </div>

      <div id="manager-fields" class="hidden">
        <div class="mb-3">
          <label for="managerTelemovel" class="form-label">Phone Number</label>
          <input type="text" id="managerTelemovel" name="managerTelemovel" class="form-control"
            placeholder="Phone number" pattern="[0-9]{9}" title="The number must be 9 digits" />
        </div>
      </div>
      <button type="submit" class="btn btn-register">Register</button>
    </form>

    <div class="login">
      <span>Already have an account? <a href="/auth/login">Log in here</a></span>
    </div>
  </div>

  <script>
    function toggleForm() {
  const role = document.getElementById("role").value.toLowerCase(); // Converte para minúsculas
  const clienteFields = document.getElementById("cliente-fields");
  const managerFields = document.getElementById("manager-fields");

  if (role === "client") {
    clienteFields.classList.remove("hidden");
    clienteFields.style.display = "grid";
    managerFields.classList.add("hidden");
    managerFields.style.display = "none";
  } else if (role === "manager") {
    managerFields.classList.remove("hidden");
    managerFields.style.display = "grid";
    clienteFields.classList.add("hidden");
    clienteFields.style.display = "none";
  } else {
    clienteFields.classList.add("hidden");
    clienteFields.style.display = "none";
    managerFields.classList.add("hidden");
    managerFields.style.display = "none";
  }
}

// Garante que os campos estejam ocultos ao carregar a página
document.addEventListener("DOMContentLoaded", toggleForm);

// Adiciona o evento de mudança ao campo "role"
document.getElementById("role").addEventListener("change", toggleForm);

    toggleForm();

    document
      .querySelector("form")
      .addEventListener("submit", function (event) {
        let valid = true;

        document.getElementById("password-alert").classList.add("hidden");
        document.getElementById("field-alert").classList.add("hidden");
        document
          .getElementById("invalid-format-alert")
          .classList.add("hidden");

        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const clienteTelemovel =
          document.getElementById("clienteTelemovel").value;
        const clienteNif = document.getElementById("clienteNif").value;

        if (password !== confirmPassword) {
          document
            .getElementById("password-alert")
            .classList.remove("hidden");
          valid = false;
        }

        if (
          !password ||
          !confirmPassword ||
          !document.getElementById("name").value ||
          !document.getElementById("email").value
        ) {
          document.getElementById("field-alert").classList.remove("hidden");
          valid = false;
        }

        if (clienteTelemovel && !/^[0-9]{9}$/.test(clienteTelemovel)) {
          document
            .getElementById("invalid-format-alert")
            .classList.remove("hidden");
          valid = false;
        }

        if (clienteNif && !/^[0-9]{9}$/.test(clienteNif)) {
          document
            .getElementById("invalid-format-alert")
            .classList.remove("hidden");
          valid = false;
        }

        if (!valid) {
          event.preventDefault();
        }
      });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Verifica se há mensagens de sucesso passadas pelo servidor
  const successMessage = "<%= typeof successMessage !== 'undefined' ? successMessage : '' %>";

  if (successMessage) {
    Swal.fire({
      icon: 'success',
      title: 'Sucesso!',
      text: successMessage,
      timer: 2000, // Exibe o alerta por 2 segundos
      showConfirmButton: false,
    }).then(() => {
      // Redireciona para a página de login após o alerta
      window.location.href = '/auth/login';
    });
  }
</script>
</body>

</html>