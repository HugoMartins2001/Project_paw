<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    <%= user.role %> dashboard
  </title>
  <link rel="stylesheet" href="/stylesheets/dashboard/managerDashboard.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="icon" type="image/png" href="/favicon.png">
</head>

<body>
  <%- include('../partials/header') %> 

  <div class="dashboard-container">
    <div style="flex: 2">
      <div class="chart-container">
        <canvas id="ordersChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="clientsChart"></canvas>
      </div>
    </div>

    <div class="manager-menu">
      <h2><%= user.role %> menu</h2>
      <div class="menu-buttons">
        <% if (user.role === 'Manager') { %>
          <a href="/restaurants/submitRestaurant" class="menu-btn"><i class="fas fa-plus-circle"></i> Create restaurant</a>
          <a href="/restaurants/showRestaurants" class="menu-btn"><i class="fas fa-store"></i> Show restaurants</a>
          <a href="/menus/submitMenu" class="menu-btn"><i class="fas fa-book"></i> Create menu</a>
          <a href="/menus/showMenus" class="menu-btn"><i class="fas fa-book-open"></i> Show menus</a>
          <a href="/dishes/submitDishes" class="menu-btn"><i class="fas fa-utensil-spoon"></i> Create Dishes</a>
          <a href="/dishes/showDishes" class="menu-btn"><i class="fas fa-list-ol"></i> Show Dishes</a>
        <% } else if (user.role === 'Admin') { %>
          <a href="/restaurants/submitRestaurant" class="menu-btn"><i class="fas fa-plus-circle"></i> Create restaurant</a>
          <a href="/restaurants/showRestaurants" class="menu-btn"><i class="fas fa-store"></i> Show restaurants</a>
          <a href="/restaurants/pendingApproval" class="menu-btn"><i class="fas fa-check-circle"></i> Approve restaurants</a>
          <a href="/menus/submitMenu" class="menu-btn"><i class="fas fa-book"></i> Create menu</a>
          <a href="/menus/showMenus" class="menu-btn"><i class="fas fa-book-open"></i> Show menus</a>
          <a href="/dishes/submitDishes" class="menu-btn"><i class="fas fa-utensil-spoon"></i> Create Dishes</a>
          <a href="/dishes/showDishes" class="menu-btn"><i class="fas fa-list-ol"></i> Show Dishes</a>
          <a href="/users/showUsers" class="menu-btn"><i class="fas fa-users"></i> Show users</a>
          <a href="/admin/logs" class="menu-btn"><i class="fas fa-chart-line"></i> View Logs & Statistics</a>
          <a href="/orders/ordersHistory" class="menu-btn"><i class="fas fa-shopping-cart"></i> Orders history</a>
        <% } else if (user.role === 'Client') { %>
          <a href="/restaurants/showRestaurants" class="menu-btn"><i class="fas fa-store"></i> Show restaurants</a>
        <% } %>
      </div>
    </div>
  </div>

  <script>
  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: true, // Exibe a legenda
        labels: {
          color: "#333", // Cor do texto da legenda
          font: {
            size: 14, // Tamanho da fonte
            family: "Arial, sans-serif", // Fonte personalizada
          },
        },
      },
      tooltip: {
        backgroundColor: "#6c63ff", // Cor de fundo do tooltip
        titleColor: "#fff", // Cor do título no tooltip
        bodyColor: "#fff", // Cor do texto no tooltip
        padding: 12, // Espaçamento interno do tooltip
        usePointStyle: true, // Usa estilo de ponto no tooltip
        borderColor: "#fff", // Borda do tooltip
        borderWidth: 1, // Largura da borda
      },
    },
    scales: {
      y: {
        beginAtZero: true,
        grid: {
          color: "rgba(0, 0, 0, 0.05)", // Cor da grade do eixo Y
        },
        ticks: {
          color: "#333", // Cor dos números no eixo Y
          font: {
            size: 12, // Tamanho da fonte
          },
        },
      },
      x: {
        grid: {
          display: false, // Oculta a grade do eixo X
        },
        ticks: {
          color: "#333", // Cor dos números no eixo X
          font: {
            size: 12, // Tamanho da fonte
          },
        },
      },
    },
  };

  // Função para carregar os dados do dashboard
  async function loadDashboardData() {
    try {
      const response = await fetch('/dashboard/data'); // Faz a requisição para o endpoint
      if (!response.ok) {
        throw new Error("Erro ao carregar os dados do dashboard");
      }

      const { months, restaurantData, userData } = await response.json();

      // Gráfico de restaurantes criados
      new Chart(document.getElementById("ordersChart"), {
        type: "bar",
        data: {
          labels: months, // Meses
          datasets: [
            {
              label: "Restaurantes Criados",
              data: restaurantData, // Dados de restaurantes
              backgroundColor: "rgba(108, 99, 255, 0.8)", // Cor das barras
              borderColor: "rgba(108, 99, 255, 1)", // Cor da borda das barras
              borderWidth: 2, // Largura da borda
              borderRadius: 10, // Bordas arredondadas
              hoverBackgroundColor: "rgba(108, 99, 255, 1)", // Cor ao passar o mouse
              hoverBorderColor: "#fff", // Cor da borda ao passar o mouse
            },
          ],
        },
        options: chartOptions,
      });

      // Gráfico de usuários registrados
      new Chart(document.getElementById("clientsChart"), {
        type: "line",
        data: {
          labels: months, // Meses
          datasets: [
            {
              label: "Utilizadores Registados",
              data: userData, // Dados de usuários
              borderColor: "rgba(108, 99, 255, 1)", // Cor da linha
              backgroundColor: "rgba(108, 99, 255, 0.2)", // Cor de preenchimento abaixo da linha
              tension: 0.4, // Suaviza as curvas da linha
              fill: true, // Preenche a área abaixo da linha
              borderWidth: 3, // Largura da linha
              pointBackgroundColor: "#fff", // Cor do ponto
              pointBorderColor: "rgba(108, 99, 255, 1)", // Cor da borda do ponto
              pointBorderWidth: 2, // Largura da borda do ponto
              pointHoverBackgroundColor: "#fff", // Cor do ponto ao passar o mouse
              pointHoverBorderColor: "rgba(108, 99, 255, 1)", // Cor da borda ao passar o mouse
              pointHoverBorderWidth: 3, // Largura da borda ao passar o mouse
            },
          ],
        },
        options: chartOptions,
      });
    } catch (err) {
      console.error("Erro ao carregar os dados do dashboard:", err);
    }
  }

  // Carregar os dados ao carregar a página
  loadDashboardData();
</script>
</body>

</html>