<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-4">Available Restaurants</h1>
    </div>

  <div class="mb-3" *ngIf="userRole === 'Manager' || userRole === 'Admin'">
    <a [routerLink]="['/restaurants/create']" class="btn btn-success">Criar Restaurante</a>
  </div>

  <div class="row mb-4">
    <div class="col-md-4 mb-2">
      <input type="text" class="form-control" placeholder="Search by name" [(ngModel)]="filterName" (input)="fetchRestaurants()" />
    </div>
    <div class="col-md-4 mb-2">
      <input type="text" class="form-control" placeholder="Filter by address" [(ngModel)]="filterAddress" (input)="fetchRestaurants()" />
    </div>
  </div>

  <div *ngIf="isLoading" class="alert alert-info text-center">Loading...</div>
  <div *ngIf="!isLoading && restaurants.length === 0" class="alert alert-warning text-center">
    <h3>No restaurants found.</h3>
  </div>

  <div class="row g-4" *ngIf="!isLoading && restaurants.length > 0">
    <div class="col-md-6 col-lg-4" *ngFor="let restaurant of restaurants">
      <ng-container *ngIf="restaurant.isApproved === true">
        <div class="card restaurant-card h-100">
          <div class="restaurant-img-container" *ngIf="restaurant.restaurantPic; else noImage">
            <img [src]="getRestaurantImageUrl(restaurant.restaurantPic)" [alt]="restaurant.name" class="restaurant-img" />
          </div>
          <ng-template #noImage>
            <div class="restaurant-img-container no-img">
              <p>No image</p>
            </div>
          </ng-template>

          <div class="card-body d-flex flex-column justify-content-between">
            <div>
              <h5 class="restaurant-name d-flex justify-content-between align-items-center">
                Name: {{ restaurant.name }}
                <span class="restaurant-rating"><i class="fas fa-star"></i> 4.5</span>
              </h5>
              <p class="restaurant-location"> Address: {{ restaurant.address }}</p>

              <div class="text-muted small mb-2">
                <span *ngIf="restaurant.menus?.length">
                  Menu: {{ restaurant.menus[0].name }}
                  <span *ngIf="restaurant.menus.length > 1">+{{ restaurant.menus.length - 1 }} more</span>
                </span>
                <span *ngIf="!restaurant.menus?.length">No menus</span>
              </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mt-3">
              <button *ngIf="!userRole" class="btn btn-sm btn-outline-secondary" disabled>Login to view</button>

              <ng-container *ngIf="userRole === 'Client' || userRole === 'Manager' || userRole === 'Admin'">
                <a [routerLink]="['/restaurant-details', restaurant.name]" class="btn btn-sm btn-outline-primary">View</a>
              </ng-container>

              <ng-container *ngIf="(userRole === 'Manager' && (restaurant.managerId?._id === userId || restaurant.managerId === userId)) || userRole === 'Admin'">
                <a [routerLink]="['/restaurants/editRestaurant', restaurant._id]" class="btn btn-sm btn-outline-warning ms-2">Edit</a>
                <button class="btn btn-sm btn-outline-danger ms-2" (click)="deleteRestaurant(restaurant._id)">Delete</button>
                <button class="btn btn-sm ms-2" [ngClass]="restaurant.isVisible ? 'btn-outline-secondary' : 'btn-outline-success'" (click)="toggleVisibility(restaurant)">
                  {{ restaurant.isVisible ? 'Hide' : 'Show' }}
                </button>
              </ng-container>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>
