<div class="adicionar-prato-container">
  <h2 class="form-title">üçΩÔ∏è Adicionar Novo Prato</h2>

  <button type="button" class="btn-voltar" (click)="voltarAoDashboard()">
    ‚Üê Voltar
  </button>

  <form (ngSubmit)="guardarPrato(f)" #f="ngForm" novalidate>
    <!-- Informa√ß√£o B√°sica -->
    <fieldset>
      <legend>üìù Informa√ß√£o B√°sica</legend>
      <div class="form-group">
        <label>Nome do Prato *</label>
        <input
          type="text"
          [(ngModel)]="prato.nome"
          name="nome"
          required
          #nome="ngModel"
        />
        <div *ngIf="f.submitted && nome.invalid" class="erro-campo">
          O nome √© obrigat√≥rio.
        </div>
      </div>
      <div class="form-group">
        <label>Descri√ß√£o *</label>
        <textarea
          [(ngModel)]="prato.descricao"
          name="descricao"
          required
          #descricao="ngModel"
        ></textarea>
        <div *ngIf="f.submitted && descricao.invalid" class="erro-campo">
          A descri√ß√£o √© obrigat√≥ria.
        </div>
      </div>
    </fieldset>

    <!-- Categoria -->
    <fieldset>
      <legend>üç¥ Categoria</legend>
      <div class="form-group">
        <label>Categoria Principal *</label>
        <select
          [(ngModel)]="categoriaSelecionada"
          name="categoriaPrincipal"
          required
          #categoriaPrincipal="ngModel"
          (change)="atualizarSubcategorias()"
        >
          <option [ngValue]="null" disabled hidden>
            Seleciona uma categoria principal
          </option>
          <option *ngFor="let cat of categoriasPrincipais" [value]="cat">
            {{ cat }}
          </option>
        </select>
        <div *ngIf="f.submitted && categoriaPrincipal.invalid" class="erro-campo">
          Categoria obrigat√≥ria.
        </div>
      </div>

      <div class="form-group">
        <label>Subcategoria *</label>
        <select
          [(ngModel)]="prato.subcategoria"
          name="subcategoria"
          required
          #subcategoria="ngModel"
        >
          <option [ngValue]="null" disabled hidden>
            Seleciona uma subcategoria
          </option>
          <option *ngFor="let sub of subcategoriasDisponiveis" [value]="sub">
            {{ sub }}
          </option>
        </select>
        <div *ngIf="f.submitted && subcategoria.invalid" class="erro-campo">
          Subcategoria obrigat√≥ria.
        </div>
      </div>
    </fieldset>

    <!-- Informa√ß√£o Nutricional -->
    <fieldset>
      <legend>üçé Informa√ß√£o Nutricional</legend>
      <div class="form-group-grouped">
        <div class="form-group">
          <label>Calorias</label>
          <input
            type="number"
            [(ngModel)]="prato.infoNutricional.calorias"
            name="calorias"
          />
        </div>
        <div class="form-group">
          <label>Prote√≠nas (g)</label>
          <input
            type="number"
            [(ngModel)]="prato.infoNutricional.proteinas"
            name="proteinas"
          />
        </div>
        <div class="form-group">
          <label>Hidratos (g)</label>
          <input
            type="number"
            [(ngModel)]="prato.infoNutricional.hidratos"
            name="hidratos"
          />
        </div>
        <div class="form-group">
          <label>Gorduras (g)</label>
          <input
            type="number"
            [(ngModel)]="prato.infoNutricional.gorduras"
            name="gorduras"
          />
        </div>
      </div>
      <div *ngIf="f.submitted && infoNutricionalVazia" class="erro-campo">
        Preenche pelo menos um campo da informa√ß√£o nutricional.
      </div>
    </fieldset>

    <!-- Alerg√©nios -->
    <fieldset>
      <legend>‚ö†Ô∏è Alerg√©nios</legend>
      <div class="checkbox-group">
        <label>
          <input
            type="checkbox"
            [(ngModel)]="semAlergenios"
            (change)="aoSelecionarSemAlergenios()"
            name="semAlergenios"
          />
          Sem Alerg√©nios
        </label>
        <label
          *ngFor="let a of ['gluten', 'lactose', 'ovo', 'peixe', 'soja', 'outros']"
        >
          <input
            type="checkbox"
            [value]="a"
            (change)="toggleAlergeneo(a)"
            [disabled]="semAlergenios"
            [checked]="alergeneosSelecionados.includes(a)"
          />
          {{ a | titlecase }}
        </label>
        <input
          type="text"
          [(ngModel)]="alergeneoOutroTexto"
          name="alergeneoOutroTexto"
          placeholder="Se 'outros', descreve..."
        />
      </div>
      <div *ngIf="f.submitted && alergeneosVazios" class="erro-campo">
        Indica pelo menos um alerg√©nio ou seleciona "Sem Alerg√©nios".
      </div>
    </fieldset>

    <!-- Doses -->
    <fieldset>
      <legend>üçΩÔ∏è Tipos de Dose</legend>
      <div class="dose-container">
        <div class="form-group" *ngFor="let dose of doses; let i = index">
          <input
            type="text"
            [(ngModel)]="dose.nome"
            name="doseNome{{ i }}"
            placeholder="Nome (ex: Normal)"
            required
          />
          <input
            type="number"
            [(ngModel)]="dose.preco"
            name="dosePreco{{ i }}"
            placeholder="Pre√ßo (‚Ç¨)"
            required
          />
          <button type="button" (click)="removerDose(i)">üóëÔ∏è</button>
        </div>
        <div *ngIf="f.submitted && dosesInvalidas" class="erro-campo">
          Todas as doses devem ter nome e pre√ßo v√°lido.
        </div>
        <button type="button" (click)="adicionarDose()">
          + Adicionar Dose
        </button>
      </div>
    </fieldset>

    <!-- Imagem -->
    <fieldset>
      <legend>üñºÔ∏è Imagem do Prato</legend>
      <div class="form-group">
        <label>Selecionar imagem *</label>
        <input
          type="file"
          (change)="onFileChange($event)"
          accept="image/*"
          [required]="!imagemSelecionada"
        />
        <img
          *ngIf="imagemPreview"
          [src]="imagemPreview"
          class="imagem-preview"
        />
        <div *ngIf="f.submitted && !imagemSelecionada" class="erro-campo">
          Imagem obrigat√≥ria.
        </div>
      </div>
    </fieldset>

    <div *ngIf="erro" class="erro-msg">{{ erro }}</div>

    <button type="submit" class="btn-laranja">Adicionar Prato</button>
  </form>

  <!-- MODAL DE SUCESSO -->
  <div
    class="modal-backdrop"
    *ngIf="pratoAdicionadoComSucesso"
    (click)="pratoAdicionadoComSucesso = false"
  >
    <div class="modal-content-sucesso" (click)="$event.stopPropagation()">
      <h2>‚úÖ Prato adicionado com sucesso!</h2>
      <p>Podes agora ver todos os pratos ou voltar ao in√≠cio.</p>
      <div class="botoes-modal">
        <button class="btn-laranja" (click)="irParaListarPratos()">
          Ver Pratos
        </button>
        <button class="btn" (click)="voltarAoDashboard()">Voltar</button>
      </div>
    </div>
  </div>
</div>
