<!-- Navbar -->
<div class="navbar">
  <div class="logo">
    <a routerLink="/restaurante/dashboard" style="text-decoration: none">
      <img
        src="/paw-restaurantes/frontend/public/website/ServeLogo.png"
        alt="Serve Point"
        style="height: 60px; object-fit: contain"
      />
    </a>
  </div>

  <div class="links" style="display: flex; align-items: center; gap: 30px">
    <!-- MENUS -->
    <div
      id="menus-dropdown"
      style="position: relative"
      (click)="toggleDropdown('menus', $event)"
    >
      <span style="cursor: pointer; font-weight: bold">Menus ‚ñæ</span>
      <ul
        *ngIf="dropdowns.menus"
        style="
          position: absolute;
          top: 100%;
          left: 0;
          background: white;
          border: 1px solid #ccc;
          border-radius: 6px;
          padding: 8px 0;
          z-index: 999;
        "
      >
        <li>
          <a class="dropdown-item" routerLink="/menu/listar">Ver Menus</a>
        </li>
        <li>
          <a class="dropdown-item" routerLink="/menu/adicionar">Criar Menu</a>
        </li>
      </ul>
    </div>

    <!-- PRATOS -->
    <div
      id="pratos-dropdown"
      style="position: relative"
      (click)="toggleDropdown('pratos', $event)"
    >
      <span style="cursor: pointer; font-weight: bold">Pratos ‚ñæ</span>
      <ul
        *ngIf="dropdowns.pratos"
        style="
          position: absolute;
          top: 100%;
          left: 0;
          background: white;
          border: 1px solid #ccc;
          border-radius: 6px;
          padding: 8px 0;
          z-index: 999;
        "
      >
        <li>
          <a class="dropdown-item" routerLink="/prato/listar">Ver Pratos</a>
        </li>
        <li>
          <a class="dropdown-item" routerLink="/prato/adicionar">Criar Prato</a>
        </li>
      </ul>
    </div>
    <!-- Encomendas -->
    <a routerLink="/encomendas" style="font-weight: bold">Encomendas</a>
  </div>

  <!-- Perfil -->
  <div class="profile-container">
    <div class="profile-image" (click)="togglePerfilDropdown()">
      <img
        [src]="
          restaurante?.logoUrl
            ? 'http://localhost:3000' + restaurante.logoUrl
            : 'https://via.placeholder.com/150'
        "
      />
    </div>
    <div class="dropdown-menu" [class.show]="dropdownVisible">
      <a routerLink="/perfil/visualizar">Ver Perfil</a>
      <a routerLink="/restaurante/editar">Editar Perfil</a>
      <div class="dropdown-divider"></div>
      <a (click)="logout()">Logout</a>
    </div>
  </div>
</div>

<!-- Boas Vindas -->
<div class="text-center mb-5">
  <h1 class="text-primary" style="color: rgb(227, 105, 17) !important">
    Ol√°, {{ restaurante.nome }}
  </h1>
  <p class="text-muted">Bem-vindo ao seu painel de controlo</p>
</div>

<!-- Estat√≠sticas -->
<div class="container">
  <div
    class="row content-container"
    style="margin-right: 30px"
    id="estatisticas"
  >
    <div class="container-title">ESTAT√çSTICAS</div>
    <div class="cards-container">
      <div class="col-4 estatistica-card">
        <div class="card-title">N¬∫ Encomendas:</div>
        <div class="valor">{{ estatisticas.numEncomendas }}</div>
      </div>
      <div class="col-4 estatistica-card">
        <div class="card-title">Pratos Ativos:</div>
        <div class="valor">{{ estatisticas.pratosAtivos }}</div>
      </div>
      <div class="col-4 estatistica-card">
        <div class="card-title">Menus Ativos:</div>
        <div class="valor">{{ estatisticas.menusAtivos }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Conte√∫do principal -->
<div class="container">
  <div class="coluna-esquerda">
    <!-- MENUS -->
    <div class="row content-container" id="menus">
      <div class="container-title">MENUS</div>
      <div class="cards-container">
        <div
          class="col-4 menu-card"
          *ngFor="let menu of menus"
          (click)="abrirModal(menu, 'menu')"
        >
          <div class="menu-image-container">
            <img [src]="'http://localhost:3000' + menu.imagem" />
          </div>
          <div class="menu-content">
            <div class="menu-title">{{ menu.nome || "Sem Nome" }}</div>
            <div class="menu-description">
              {{ menu.descricao || "Sem descri√ß√£o" }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PRATOS -->
    <div class="row content-container" id="pratos">
      <div class="container-title">PRATOS</div>
      <div class="cards-container">
        <div
          class="col-4 menu-card"
          *ngFor="let prato of pratos"
          (click)="abrirModal(prato, 'prato')"
        >
          <div class="menu-image-container">
            <img [src]="'http://localhost:3000' + prato.imagem" />
          </div>
          <div class="menu-content">
            <div class="menu-title">
              {{ prato.nome?.slice(0, 30) || "Sem Nome" }}
            </div>
            <div class="menu-description">
              {{ prato.descricao?.slice(0, 60) || "Sem descri√ß√£o" }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ENCOMENDAS -->
  <div class="coluna-direita">
    <div class="col encomendas-container" id="encomendas">
      <div class="container-title">ENCOMENDAS</div>
      <div class="row mt-3 justify-content-center">
        <div
          class="col-10 mb-3 d-flex justify-content-center"
          *ngFor="let e of encomendas"
        >
          <div class="encomenda-card">
            <div class="encomenda-nome">{{ e.nomeCliente }}</div>
            <div class="status-dot" [attr.data-status]="e.status"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- MODAL DE DETALHES -->
<!-- MODAL BACKDROP -->
<div class="modal-backdrop fade show" *ngIf="modalVisible"></div>

<!-- MODAL -->
<div
  class="modal show d-block"
  tabindex="-1"
  *ngIf="modalVisible"
  style="z-index: 1055"
>
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">üîç Detalhes do {{ modalTipo | titlecase }}</h5>
        <button
          type="button"
          class="btn-close"
          aria-label="Close"
          (click)="fecharModal()"
        ></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <!-- IMAGEM -->
          <div class="col-md-5 mb-3">
            <img
              [src]="'http://localhost:3000' + modalItem?.imagem"
              alt="Imagem do Prato"
              class="modal-img w-100 rounded"
              *ngIf="modalItem?.imagem"
            />
          </div>

          <!-- INFO -->
          <div class="col-md-7">
            <h4>{{ modalItem?.nome }}</h4>
            <p class="text-muted">{{ modalItem?.descricao }}</p>

            <!-- DOSES -->
            <div *ngIf="modalItem?.doses?.length">
              <h6 class="fw-bold mt-3">üçΩÔ∏è Doses:</h6>
              <ul class="list-group list-group-flush">
                <li
                  class="list-group-item px-0 py-1"
                  *ngFor="let d of modalItem.doses"
                >
                  {{ d.nome }} ‚Äì <strong>‚Ç¨{{ d.preco.toFixed(2) }}</strong>
                </li>
              </ul>
            </div>

            <!-- DISPONIBILIDADE -->
            <span
              class="badge mt-3"
              [ngClass]="modalItem?.disponivel ? 'bg-success' : 'bg-danger'"
            >
              {{ modalItem?.disponivel ? "Dispon√≠vel" : "Indispon√≠vel" }}
            </span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fecharModal()">
          Fechar
        </button>
        <a
          [routerLink]="[
            '/',
            modalTipo,
            'detalhes',
            modalItem?._id || modalItem?.id
          ]"
          class="btn btn-primary"
        >
          Ver Detalhes
        </a>
        <a
          [routerLink]="['/', modalTipo, modalItem?.id, 'editar']"
          class="btn btn-warning text-white"
        >
          Editar
        </a>
      </div>
    </div>
  </div>
</div>
