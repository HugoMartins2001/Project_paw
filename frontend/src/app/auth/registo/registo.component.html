<div class="wrapper">
  <div class="form-container">
    <form [formGroup]="registoForm" (ngSubmit)="onSubmit()" enctype="multipart/form-data">
      <h2>Criar Conta</h2>

      <!-- Mensagem de Erro Geral -->
      <div *ngIf="errors?.geral" class="alert alert-danger text-center fw-bold">
        {{ errors.geral }}
      </div>

      <!-- Nome -->
      <div class="mb-3">
        <label for="name" class="form-label">Nome</label>
        <input type="text" id="name" formControlName="name" class="form-control" placeholder="Digite seu nome"
          [ngClass]="{ 'is-invalid': registoForm.get('name')?.invalid && registoForm.get('name')?.touched }" />
        <div class="text-danger"
          *ngIf="registoForm.get('name')?.hasError('required') && registoForm.get('name')?.touched">
          O nome é obrigatório.
        </div>
      </div>

      <!-- Email -->
      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" id="email" formControlName="email" class="form-control" placeholder="Digite seu email"
          [ngClass]="{ 'is-invalid': registoForm.get('email')?.invalid && registoForm.get('email')?.touched }" />
        <div class="text-danger"
          *ngIf="registoForm.get('email')?.hasError('required') && registoForm.get('email')?.touched">
          O email é obrigatório.
        </div>
        <div class="text-danger"
          *ngIf="registoForm.get('email')?.hasError('email') && registoForm.get('email')?.touched">
          Formato de email inválido.
        </div>
      </div>

      <!-- Senha -->
      <div class="mb-3 password-container">
        <label for="password" class="form-label">Senha</label>
        <div class="input-group">
          <input type="password" id="password" formControlName="password" class="form-control"
            placeholder="Digite sua senha" (input)="onPasswordInput()" />
          <button type="button" id="togglePassword" class="btn btn-outline-secondary"
            (click)="togglePasswordVisibility()" aria-label="Mostrar ou ocultar senha">
            <i [class]="passwordVisible ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div id="passwordStrength" class="passwordStrength">
          <div id="strength-bar" class="strength-bar" [style.width]="passwordStrength.percent + '%'"
            [style.backgroundColor]="passwordStrength.color"></div>
        </div>
        <small id="strength-text" class="strength-text" [style.color]="passwordStrength.color">
          {{ passwordStrength.message }}
        </small>
      </div>

      <!-- Confirmar Senha -->
      <div class="mb-3 password-container">
        <label for="confirmPassword" class="form-label">Confirmar Senha</label>
        <div class="input-group">
          <input type="password" id="confirmPassword" formControlName="confirmPassword" class="form-control"
            placeholder="Confirme sua senha" />
          <button type="button" id="toggleConfirmPassword" class="btn btn-outline-secondary"
            (click)="toggleConfirmPasswordVisibility()" aria-label="Mostrar ou ocultar confirmação de senha">
            <i [class]="confirmPasswordVisible ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div class="text-danger" *ngIf="passwordMismatch">
          As senhas não coincidem.
        </div>
      </div>

      <!-- Foto de Perfil -->
      <div class="mb-3">
        <label for="profilePic" class="form-label">Foto de Perfil</label>
        <input type="file" id="profilePic" (change)="onFileChange($event, 'profilePic')" class="form-control"
          accept="image/*" />
      </div>

      <!-- Tipo de Conta -->
      <div class="mb-3">
        <label for="role" class="form-label">Tipo de Conta</label>
        <select id="role" formControlName="role" class="form-select" (change)="onRoleChange()">
          <option value="" disabled>Selecione um tipo</option>
          <option value="cliente">Client</option>
          <option value="manager">Manager</option>
        </select>
      </div>

      <!-- Campos para Cliente -->
      <div *ngIf="registoForm.get('role')?.value === 'cliente'" id="cliente-fields">
        <div class="mb-3">
          <label for="clienteTelemovel" class="form-label">Telefone</label>
          <input type="text" id="clienteTelemovel" formControlName="clienteTelemovel" class="form-control"
            placeholder="Número de telefone" pattern="[0-9]{9}" />
          <div class="text-danger"
            *ngIf="registoForm.get('clienteTelemovel')?.hasError('required') && registoForm.get('clienteTelemovel')?.touched">
            O telefone é obrigatório.
          </div>
          <div class="text-danger"
            *ngIf="registoForm.get('clienteTelemovel')?.hasError('pattern') && registoForm.get('clienteTelemovel')?.touched">
            O telefone deve conter 9 dígitos.
          </div>
        </div>
        <div class="mb-3">
          <label for="clienteNif" class="form-label">NIF</label>
          <input type="text" id="clienteNif" formControlName="clienteNif" class="form-control"
            placeholder="Número de contribuinte" pattern="[0-9]{9}" />
          <div class="text-danger"
            *ngIf="registoForm.get('clienteNif')?.hasError('required') && registoForm.get('clienteNif')?.touched">
            O NIF é obrigatório.
          </div>
          <div class="text-danger"
            *ngIf="registoForm.get('clienteNif')?.hasError('pattern') && registoForm.get('clienteNif')?.touched">
            O NIF deve conter 9 dígitos.
          </div>
        </div>
        <div class="mb-3">
          <label for="address" class="form-label">Morada</label>
          <input type="text" id="address" formControlName="address" class="form-control"
            placeholder="Digite sua morada" />
          <div class="text-danger"
            *ngIf="registoForm.get('address')?.hasError('required') && registoForm.get('address')?.touched">
            A morada é obrigatória.
          </div>
        </div>
      </div>

      <!-- Campos para Gerente -->
      <div *ngIf="registoForm.get('role')?.value === 'manager'" id="manager-fields">
        <div class="mb-3">
          <label for="managerTelemovel" class="form-label">Telefone</label>
          <input type="text" id="managerTelemovel" formControlName="managerTelemovel" class="form-control"
            placeholder="Número de telefone" pattern="[0-9]{9}" />
          <div class="text-danger"
            *ngIf="registoForm.get('managerTelemovel')?.hasError('required') && registoForm.get('managerTelemovel')?.touched">
            O telefone é obrigatório.
          </div>
          <div class="text-danger"
            *ngIf="registoForm.get('managerTelemovel')?.hasError('pattern') && registoForm.get('managerTelemovel')?.touched">
            O telefone deve conter 9 dígitos.
          </div>
        </div>
      </div>

      <!-- Botão de Submissão -->
      <button type="submit" class="btn btn-primary">Registar</button>
    </form>
  </div>
</div>